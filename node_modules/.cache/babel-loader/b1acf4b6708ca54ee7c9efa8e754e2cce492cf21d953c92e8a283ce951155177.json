{"ast":null,"code":"var _jsxFileName = \"/Users/eshaantripathi/Documents/GitHub/STUCO-Attendance/src/ScanQRCode.jsx\",\n  _s = $RefreshSig$();\n// src/ScanQRCode.jsx\nimport React, { useState, useEffect, useCallback, useMemo, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport QrReader from 'modern-react-qr-reader';\nimport { auth, db } from './firebase';\nimport { doc, getDoc, updateDoc, arrayUnion } from 'firebase/firestore';\nimport './AdminInterface.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ScanQRCode = () => {\n  _s();\n  const [error, setError] = useState('');\n  const [legacyMode, setLegacyMode] = useState(false);\n  const qrRef = useRef(null);\n  const navigate = useNavigate();\n\n  // Redirect if not logged in\n  useEffect(() => {\n    if (!auth.currentUser) {\n      navigate('/');\n    }\n  }, [navigate]);\n\n  // Handler when a QR is successfully scanned\n  const handleScan = useCallback(async data => {\n    if (!data) return;\n    const sessionId = data.trim();\n    const sessRef = doc(db, 'attendanceSessions', sessionId);\n    const sessSnap = await getDoc(sessRef);\n    if (!sessSnap.exists() || !sessSnap.data().open) {\n      setError('No active session with that code.');\n      return;\n    }\n    const email = auth.currentUser.email;\n    const username = email.split('@')[0];\n    const userRef = doc(db, 'users', username);\n    await updateDoc(userRef, {\n      attendance: arrayUnion(sessionId)\n    });\n    navigate('/dashboard');\n  }, [navigate]);\n\n  // Error handler: if camera is unsupported, flip into legacyMode\n  const handleError = useCallback(err => {\n    console.error(err);\n    setError('Camera error: ' + err.message);\n    setLegacyMode(true);\n  }, []);\n\n  // Open the image-picker dialog (for legacyMode)\n  const openImageDialog = () => {\n    if (qrRef.current) {\n      qrRef.current.openImageDialog();\n    }\n  };\n\n  // Keep the camera facing config stable\n  const videoConstraints = useMemo(() => ({\n    facingMode: 'environment'\n  }), []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"admin-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"admin-btn\",\n      style: {\n        marginBottom: '1rem'\n      },\n      onClick: () => navigate(-1),\n      children: \"\\u2190 Back\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n      className: \"admin-title\",\n      children: \"Scan QR Code to Check In\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"qr-container\",\n      children: [legacyMode && /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"admin-btn\",\n        style: {\n          marginBottom: '1rem'\n        },\n        onClick: openImageDialog,\n        children: \"\\uD83D\\uDCF8 Take/Upload Photo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(QrReader, {\n        ref: qrRef,\n        delay: 500,\n        onError: handleError,\n        onScan: handleScan\n        // prefer the native facingMode prop; constraints is optional\n        ,\n        facingMode: \"environment\",\n        resolution: 600,\n        legacyMode: legacyMode,\n        showViewFinder: !legacyMode,\n        style: {\n          width: '100%'\n        },\n        constraints: videoConstraints\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 9\n    }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 19\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 75,\n    columnNumber: 7\n  }, this);\n};\n_s(ScanQRCode, \"12dA4jCi4Jz90wgRiBIAK7ytQW8=\", false, function () {\n  return [useNavigate];\n});\n_c = ScanQRCode;\nexport default ScanQRCode;\nvar _c;\n$RefreshReg$(_c, \"ScanQRCode\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","useMemo","useRef","useNavigate","QrReader","auth","db","doc","getDoc","updateDoc","arrayUnion","jsxDEV","_jsxDEV","ScanQRCode","_s","error","setError","legacyMode","setLegacyMode","qrRef","navigate","currentUser","handleScan","data","sessionId","trim","sessRef","sessSnap","exists","open","email","username","split","userRef","attendance","handleError","err","console","message","openImageDialog","current","videoConstraints","facingMode","className","children","style","marginBottom","onClick","fileName","_jsxFileName","lineNumber","columnNumber","ref","delay","onError","onScan","resolution","showViewFinder","width","constraints","_c","$RefreshReg$"],"sources":["/Users/eshaantripathi/Documents/GitHub/STUCO-Attendance/src/ScanQRCode.jsx"],"sourcesContent":["// src/ScanQRCode.jsx\nimport React, {\n    useState,\n    useEffect,\n    useCallback,\n    useMemo,\n    useRef\n  } from 'react';\n  import { useNavigate } from 'react-router-dom';\n  import QrReader from 'modern-react-qr-reader';\n  import { auth, db } from './firebase';\n  import { doc, getDoc, updateDoc, arrayUnion } from 'firebase/firestore';\n  import './AdminInterface.css';\n  \n  const ScanQRCode = () => {\n    const [error, setError] = useState('');\n    const [legacyMode, setLegacyMode] = useState(false);\n    const qrRef = useRef(null);\n    const navigate = useNavigate();\n  \n    // Redirect if not logged in\n    useEffect(() => {\n      if (!auth.currentUser) {\n        navigate('/');\n      }\n    }, [navigate]);\n  \n    // Handler when a QR is successfully scanned\n    const handleScan = useCallback(\n      async (data) => {\n        if (!data) return;\n        const sessionId = data.trim();\n        const sessRef = doc(db, 'attendanceSessions', sessionId);\n        const sessSnap = await getDoc(sessRef);\n  \n        if (!sessSnap.exists() || !sessSnap.data().open) {\n          setError('No active session with that code.');\n          return;\n        }\n  \n        const email = auth.currentUser.email;\n        const username = email.split('@')[0];\n        const userRef = doc(db, 'users', username);\n  \n        await updateDoc(userRef, {\n          attendance: arrayUnion(sessionId)\n        });\n  \n        navigate('/dashboard');\n      },\n      [navigate]\n    );\n  \n    // Error handler: if camera is unsupported, flip into legacyMode\n    const handleError = useCallback((err) => {\n      console.error(err);\n      setError('Camera error: ' + err.message);\n      setLegacyMode(true);\n    }, []);\n  \n    // Open the image-picker dialog (for legacyMode)\n    const openImageDialog = () => {\n      if (qrRef.current) {\n        qrRef.current.openImageDialog();\n      }\n    };\n  \n    // Keep the camera facing config stable\n    const videoConstraints = useMemo(\n      () => ({ facingMode: 'environment' }),\n      []\n    );\n  \n    return (\n      <div className=\"admin-container\">\n        <button\n          className=\"admin-btn\"\n          style={{ marginBottom: '1rem' }}\n          onClick={() => navigate(-1)}\n        >\n          ‚Üê Back\n        </button>\n  \n        <h2 className=\"admin-title\">Scan QR Code to Check In</h2>\n  \n        <div className=\"qr-container\">\n          {/* If legacyMode is on, show a button to let user pick/take a photo */}\n          {legacyMode && (\n            <button\n              className=\"admin-btn\"\n              style={{ marginBottom: '1rem' }}\n              onClick={openImageDialog}\n            >\n              üì∏ Take/Upload Photo\n            </button>\n          )}\n  \n          <QrReader\n            ref={qrRef}\n            delay={500}\n            onError={handleError}\n            onScan={handleScan}\n            // prefer the native facingMode prop; constraints is optional\n            facingMode=\"environment\"\n            resolution={600}\n            legacyMode={legacyMode}\n            showViewFinder={!legacyMode}\n            style={{ width: '100%' }}\n            constraints={videoConstraints}\n          />\n        </div>\n  \n        {error && <div className=\"error\">{error}</div>}\n      </div>\n    );\n  };\n  \n  export default ScanQRCode;\n  "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}